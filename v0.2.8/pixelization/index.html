<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Maps and Pixels · Pixell.jl</title><meta name="title" content="Maps and Pixels · Pixell.jl"/><meta property="og:title" content="Maps and Pixels · Pixell.jl"/><meta property="twitter:title" content="Maps and Pixels · Pixell.jl"/><meta name="description" content="Documentation for Pixell.jl."/><meta property="og:description" content="Documentation for Pixell.jl."/><meta property="twitter:description" content="Documentation for Pixell.jl."/><meta property="og:url" content="https://simonsobs.github.io/Pixell.jl/pixelization/"/><meta property="twitter:url" content="https://simonsobs.github.io/Pixell.jl/pixelization/"/><link rel="canonical" href="https://simonsobs.github.io/Pixell.jl/pixelization/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Pixell.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Quickstart</a></li><li class="is-active"><a class="tocitem" href>Maps and Pixels</a><ul class="internal"><li><a class="tocitem" href="#Rectangular-Pixelizations"><span>Rectangular Pixelizations</span></a></li><li><a class="tocitem" href="#Sky-to-Pixels-and-Back"><span>Sky to Pixels and Back</span></a></li></ul></li><li><a class="tocitem" href="../config/">Configuration</a></li><li><a class="tocitem" href="../developer_notes/">Developer Notes</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Maps and Pixels</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Maps and Pixels</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/simonsobs/Pixell.jl/blob/main/docs/src/pixelization.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Maps-and-Pixels"><a class="docs-heading-anchor" href="#Maps-and-Pixels">Maps and Pixels</a><a id="Maps-and-Pixels-1"></a><a class="docs-heading-anchor-permalink" href="#Maps-and-Pixels" title="Permalink"></a></h1><h2 id="Rectangular-Pixelizations"><a class="docs-heading-anchor" href="#Rectangular-Pixelizations">Rectangular Pixelizations</a><a id="Rectangular-Pixelizations-1"></a><a class="docs-heading-anchor-permalink" href="#Rectangular-Pixelizations" title="Permalink"></a></h2><p>Pixell allows you to work with rectangular pixelizations, with an emphasis on equidistant cylindrical projections (ECP) like <a href="https://pro.arcgis.com/en/pro-app/2.8/help/mapping/properties/plate-carree.htm">plate carrée</a>. This pixelization is identified as <code>CAR</code> in <a href="https://www.atnf.csiro.au/people/mcalabre/WCS/">WCS</a> coordinates. Invented in A.D. 100, CAR maps continue to be a useful and efficient way to map the Earth and Universe. </p><p><img src="../assets/Latitude_and_longitude_graticule_on_a_sphere.svg" alt="longitude and latitude on the sphere"/> <strong>Figure 1</strong>. <em>A CAR pixel would be one of these small rectangular patches between lines of fixed longitude and latitude. Note the singularities at the poles. CAR pixels are not the same size across the sky.</em></p><p>One of the most useful aspects of CAR maps is that the representation of the map in computer memory is a simple 2D array. The indices of these pixels are related linearly to the angles on the sky. This package can plot CAR maps as this array, but it&#39;s important to note that showing the array in this way distorts both angles and areas on the sphere, since the sphere has curvature.</p><img src="4d13da32.svg" alt="Example block output"/><p><strong>Figure 2</strong>. <em>Each square is 10 degrees on this map of the full sky, now flattened to array form. This visualization distorts the map considerably, particularly at the poles.</em></p><p>This flattened projection is a poor visualization of the sky for large sky areas, but is very good in the limit of small sky areas centered on the equator. This coincides with regions where the so-called &quot;flat-sky approximation&quot; holds, and one can perform fast fourier transforms instead of spherical harmonic transforms. Let&#39;s look at a smaller, high-resolution map centered on the equator:</p><img src="d3b946d5.svg" alt="Example block output"/><p><strong>Figure 3</strong>. <em>If you stay within a few degrees of the equator, the actual sky resembles the CAR array representation.</em></p><h2 id="Sky-to-Pixels-and-Back"><a class="docs-heading-anchor" href="#Sky-to-Pixels-and-Back">Sky to Pixels and Back</a><a id="Sky-to-Pixels-and-Back-1"></a><a class="docs-heading-anchor-permalink" href="#Sky-to-Pixels-and-Back" title="Permalink"></a></h2><p>The main way you interact with a pixelization is through the mapping of <strong>angles on the sky</strong> <span>$\Leftrightarrow$</span> <strong>pixel indices</strong>. In Pixell, these operations are called <a href="../api/#Pixell.sky2pix"><code>sky2pix</code></a> and <a href="../api/#Pixell.pix2sky"><code>pix2sky</code></a>. For a person lying on the ground located on the equator, with their head pointed towards the north celestial pole and looking outward into the cosmos, the <strong>right ascension</strong> (RA or <span>$\alpha$</span>) is the angle pointing leftwards on the sky, and the <strong>declination</strong> (DEC or <span>$\delta$</span>) is the angle away from the equator pointing upwards.</p><p><img src="../assets/Ra_and_dec_on_celestial_sphere.png" alt="longitude and latitude on the sphere"/></p><p>For a CAR map <code>my_map</code> and pixel <code>my_map[i,j]</code> with row index <span>$i$</span> and column index <span>$j$</span>, the resulting right ascension <span>$\alpha$</span> and declination <span>$\delta$</span> are given by simple linear expressions</p><p class="math-container">\[\begin{aligned}
    \alpha &amp;= \alpha_0 + \Delta \alpha \, (i - i_0)   \\
    \delta &amp;= \delta_0 + \Delta \delta \, (j - j_0)  
\end{aligned}\]</p><p>A CAR map is defined by these constants: a specific reference pixel with index <span>$i_0$</span>, <span>$j_0$</span> that has reference angle <span>$\alpha_0$</span>, <span>$\delta_0$</span>, and global pixel angular size specified by <span>$\Delta \alpha$</span>, <span>$\Delta \delta$</span>. These are stored in the FITS file header in a system called the World Coordinate System (WCS). WCS stores these numbers under different FITS header keys,</p><p class="math-container">\[\begin{aligned}
    \texttt{CRVAL} &amp;= (\alpha_0, \delta_0)   \\
    \texttt{CDELT} &amp;= (\Delta \alpha, \Delta \delta)   \\
    \texttt{CRPIX} &amp;= (i_0, j_0).
\end{aligned}\]</p><p>These numbers are carried around by the <a href="../api/#Pixell.Enmap"><code>Enmap</code></a> structure, along with the array which contains the actual map information. When you perform map operations like slicing or copying, the <a href="../api/#Pixell.Enmap"><code>Enmap</code></a> should perform the right operations on these WCS coordinates. For example, when take a subset of a map with slicing, the <code>CRPIX</code> values have to be adjusted to reflect the new map shape. The WCS information can be obtained as <code>my_map.wcs</code>. As long as you have a <em>shape</em> and <em>WCS object</em>, you can in general obtain the relation between the pixels of your map and angles on the sky. </p><p>To make a fresh map, you would create this pair of shape and wcs, such as with a convenience constructor for a small box of RA and DEC,</p><pre><code class="language-julia hljs">box = [10   -10;           # RA
       -5     5] * degree  # DEC
shape, wcs = geometry(Pixell.WCS.WCSTransform, box, 1 * degree)
my_map = Enmap(zeros(shape, wcs))</code></pre><p>Afterwards, you can obtain the shape and WCS from a map like so,</p><pre><code class="nohighlight hljs">shape = size(my_map)  # the standard way to get a shape of an array
wcs = my_map.wcs      # every map contains a WCS object</code></pre><p>To relate the sky and pixel locations in Pixell, you call the <a href="../api/#Pixell.sky2pix"><code>sky2pix</code></a> and <a href="../api/#Pixell.pix2sky"><code>pix2sky</code></a> functions. In Pixell&#39;s CAR implmentation, the horizontal direction (right ascension) is always first, and the vertical direction (declination) is second. Pixell operates <strong>only in radians</strong> for sky angles.</p><pre><code class="language-julia hljs">#  i      j                         RA   DEC
pixRA, pixDEC = sky2pix(shape, wcs, 0.0, 0.0)

ra, dec = sky2pix(shape, wcs, ind_i, ind_j)</code></pre><p>For example, you might ask what the sky position of the pixel <code>(10,20)</code> is, with map value <code>my_map[i,j]</code>. Then you would find out the RA and DEC by calling <code>pix2sky(shape, wcs, 10, 20)</code>. Similarly, if you want to know what pixel covers some point on the sky with some RA and DEC such as <span>$\alpha=0$</span>, <span>$\delta = \pi/4$</span>, you would call <code>pix2sky(shape, wcs, 0.0, π/4)</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quickstart/">« Quickstart</a><a class="docs-footer-nextpage" href="../config/">Configuration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 16 December 2023 20:34">Saturday 16 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
